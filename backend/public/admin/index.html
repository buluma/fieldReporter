<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; display: flex; }
        .sidebar { width: 200px; background-color: #333; color: white; padding: 15px; min-height: 100vh; }
        .sidebar h2 { text-align: center; }
        .sidebar ul { list-style: none; padding: 0; }
        .sidebar ul li { margin-bottom: 10px; }
        .sidebar ul li a { color: white; text-decoration: none; display: block; padding: 8px; border-radius: 4px; }
        .sidebar ul li a:hover { background-color: #575757; }
        .main-content { flex-grow: 1; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header h1 { margin: 0; }
        .logout-button { background-color: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
        .logout-button:hover { background-color: #c82333; }
        .card { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        table, th, td { border: 1px solid #ddd; }
        th, td { padding: 8px; text-align: left; }
        th { background-color: #eee; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Admin Panel</h2>
        <nav>
            <ul>
                <li><a href="#" id="navUsers">Users</a></li>
                <li><a href="#" id="navStores">Stores</a></li>
                <!-- Add more navigation items for other data entities -->
            </ul>
        </nav>
    </div>
    <div class="main-content">
        <div class="header">
            <h1 id="dashboardTitle">Welcome to Admin Dashboard</h1>
            <button class="logout-button" id="logoutButton">Logout</button>
        </div>
        <div id="contentArea">
            <div class="card">
                <h3>Dashboard Overview</h3>
                <p>Select an option from the sidebar to view data.</p>
            </div>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('jwtToken');
        if (!token) {
            window.location.href = '/admin/login.html';
        }

        document.getElementById('logoutButton').addEventListener('click', () => {
            localStorage.removeItem('jwtToken');
            window.location.href = '/admin/login.html';
        });

        async function fetchData(endpoint) {
            try {
                const response = await fetch(endpoint, {
                    headers: {
                        'x-auth-token': token
                    }
                });
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        alert('Session expired or unauthorized. Please log in again.');
                        localStorage.removeItem('jwtToken');
                        window.location.href = '/admin/login.html';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('contentArea').innerHTML = `<div class="card error-message">Error loading data: ${error.message}</div>`;
                return null;
            }
        }

        async function renderUsers() {
            document.getElementById('dashboardTitle').textContent = 'Users Management';
            const users = await fetchData('/api/admin/users');
            if (users) {
                let html = '<div class="card"><h3>All Users</h3>';
                html += '<table><thead><tr><th>ID</th><th>Username</th><th>Email</th><th>Assigned Role</th></tr></thead><tbody>';
                users.forEach(user => {
                    html += `<tr><td>${user.id}</td><td>${user.username}</td><td>${user.email}</td><td>${user.assigned}</td></tr>`;
                });
                html += '</tbody></table></div>';
                document.getElementById('contentArea').innerHTML = html;
            }
        }

        async function renderStores() {
            document.getElementById('dashboardTitle').textContent = 'Stores Management';
            const stores = await fetchData('/api/stores'); // Using the existing /api/stores endpoint
            if (stores) {
                let html = '<div class="card"><h3>All Stores</h3>';
                html += '<table><thead><tr><th>ID</th><th>Name</th><th>Region</th><th>Location</th><th>Assigned User</th></tr></thead><tbody>';
                stores.forEach(store => {
                    html += `<tr><td>${store.id}</td><td>${store.name}</td><td>${store.region}</td><td>${store.location}</td><td>${store.user_id || 'N/A'}</td></tr>`;
                });
                html += '</tbody></table></div>';
                document.getElementById('contentArea').innerHTML = html;
            }
        }

        document.getElementById('navUsers').addEventListener('click', renderUsers);
        document.getElementById('navStores').addEventListener('click', renderStores);

        // Initial render (e.g., users or a default view)
        renderUsers(); 
    </script>
</body>
</html>
